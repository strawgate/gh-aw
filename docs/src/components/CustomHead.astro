---
import type { Props } from '@astrojs/starlight/props';
import Default from '@astrojs/starlight/components/Head.astro';

const { entry } = Astro.props;
// Detect blog posts by URL path - more reliable than entry.id
const isBlogPost = Astro.url.pathname.includes('/blog/');
const canonicalURL = new URL(Astro.url.pathname, Astro.site);

// Simple hash function for deterministic image selection
function simpleHash(str: string): number {
  let hash = 0;
  for (let i = 0; i < str.length; i++) {
    hash = ((hash << 5) - hash) + str.charCodeAt(i);
    hash = hash & hash; // Convert to 32bit integer
  }
  return Math.abs(hash);
}

// Social images
const heroImage = 'https://github.github.com/gh-aw/og-hero-1200x630.png';
const peliImage = 'https://github.github.com/gh-aw/peli.png';

// For blog posts, use 50-50 mix based on URL hash
// For non-blog pages, use hero image
let socialImage: string;
if (isBlogPost) {
  // Deterministic selection based on URL path
  const useHero = simpleHash(Astro.url.pathname) % 2 === 0;
  socialImage = useHero ? heroImage : peliImage;
} else {
  socialImage = heroImage;
}

// Default site info
const siteTitle = 'GitHub Agentic Workflows';
const pageTitle = entry?.data?.title ?? siteTitle;
const pageDescription = entry?.data?.description || 'Write agentic workflows in natural language using markdown files and run them as GitHub Actions workflows.';
---

<Default {...Astro.props}><slot /></Default>

<!-- Default Open Graph tags for all pages -->
<meta property="og:type" content={isBlogPost ? 'article' : 'website'} />
<meta property="og:url" content={canonicalURL} />
<meta property="og:site_name" content={siteTitle} />
<meta property="og:title" content={pageTitle} />
<meta property="og:description" content={pageDescription} />
<meta property="og:image" content={socialImage} />

<!-- Default Twitter Card tags for all pages -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content={pageTitle} />
<meta name="twitter:description" content={pageDescription} />
<meta name="twitter:image" content={socialImage} />

<link
  rel="preload"
  href="/gh-aw/fonts/MonaSans-Regular.woff2"
  as="font"
  type="font/woff2"
  crossorigin
/>
<link
  rel="preload"
  href="/gh-aw/fonts/MonaSans-Bold.woff2"
  as="font"
  type="font/woff2"
  crossorigin
/>

<link rel="icon" type="image/svg+xml" href="/gh-aw/favicon.svg" />

<!-- Responsive tables enhancement script -->
<script>
  import '../scripts/responsive-tables.ts';
</script>

<script is:inline>
  (function() {
    const storedTheme = localStorage.getItem('starlight-theme') || 'auto';
    const isDark = storedTheme === 'dark' || (storedTheme === 'auto' && window.matchMedia('(prefers-color-scheme: dark)').matches);
    
    document.documentElement.setAttribute('data-theme', isDark ? 'dark' : 'light');
    document.documentElement.setAttribute('data-theme-mode', storedTheme);
  })();

  (function() {
    const isLandingPage = window.location.pathname === '/gh-aw/' || 
                          window.location.pathname === '/gh-aw/index.html' ||
                          window.location.pathname.endsWith('/gh-aw');
    
    if (isLandingPage) {
      if (document.body) {
        document.body.classList.add('landing-page');
      } else {
        document.addEventListener('DOMContentLoaded', function() {
          document.body.classList.add('landing-page');
        });
      }
    }
  })();
</script>
