# GitHub Actions Workflow Layout Specification

> Auto-generated specification documenting patterns used in compiled `.lock.yml` files.
> Last updated: 2026-02-16

## Overview

This document catalogs all file paths, folder names, artifact names, and other patterns used across our compiled GitHub Actions workflows (`.lock.yml` files). It serves as a comprehensive reference for developers working with the gh-aw codebase.

**Statistics:**
- **Lock files analyzed**: 154
- **Unique GitHub Actions**: 28
- **Artifact patterns**: 17
- **Job name patterns**: 22
- **File path references**: 35

## GitHub Actions

Common GitHub Actions used across compiled workflows:

| Action | Version (SHA) | Description | Context |
|--------|---------------|-------------|---------|
| `actions/checkout` | `11bd719...`, `93cb6ef...`, `de0fac2...` | Checks out repository code | Used in almost all workflows for accessing repo content |
| `actions/upload-artifact` | `b7c566a...` | Uploads build artifacts | Used for agent outputs, patches, prompts, logs, and safe-output data |
| `actions/download-artifact` | `018cc2c...` | Downloads artifacts from previous jobs | Used in safe-output jobs and conclusion jobs |
| `actions/setup-node` | `6044e13...` | Sets up Node.js environment | Used in workflows requiring npm/node |
| `actions/setup-python` | `a26af69...` | Sets up Python environment | Used for Python-based workflows and scripts |
| `actions/setup-go` | `40f1582...`, `4dc6199...`, `7a3fe6c...` | Sets up Go environment | Used for Go-based builds and tests |
| `actions/setup-java` | `c1e3236...` | Sets up Java environment | Used for Java-based workflows |
| `actions/setup-dotnet` | `67a3573...` | Sets up .NET environment | Used for .NET-based workflows |
| `actions/github-script` | `ed59741...`, `f28e40c...` | Runs GitHub API scripts | Used for GitHub API interactions and workflow logic |
| `actions/cache` | `0057852...` | Caches dependencies | Used for caching npm, pip, go modules |
| `actions/cache/restore` | `0057852...` | Restores cached dependencies | Explicit cache restore action |
| `actions/cache/save` | `0057852...` | Saves dependencies to cache | Explicit cache save action |
| `actions/ai-inference` | `a380166...` | AI inference action | Used for AI model invocation |
| `docker/setup-buildx-action` | `8d2750c...` | Sets up Docker Buildx | Used for multi-platform Docker builds |
| `docker/build-push-action` | `10e90e3...` | Builds and pushes Docker images | Used in release workflows |
| `docker/login-action` | `c94ce9f...` | Logs in to Docker registry | Used before pushing Docker images |
| `docker/metadata-action` | `c299e40...` | Extracts Docker metadata | Used for tagging Docker images |
| `astral-sh/setup-uv` | `d4b2f3b...` | Sets up uv package manager | Used for Python package management |
| `anchore/sbom-action` | `28d7154...` | Generates SBOM | Used for security and compliance |
| `super-linter/super-linter` | `2bdd90e...` | Runs super-linter | Used for code quality checks |
| `github/stale-repos` | `3477b64...` | Manages stale repositories | Used for repository maintenance |
| `./actions/setup` | N/A (local) | Custom setup action | Copies JavaScript and shell scripts to `/tmp/gh-aw/actions` |
| `github/gh-aw/actions/setup` | `c4e0918...` | Remote setup action | Same as local `./actions/setup` but referenced remotely |

## Artifact Names

Artifacts uploaded/downloaded between workflow jobs:

| Name | Upload Context | Download Context | Description |
|------|----------------|------------------|-------------|
| `agent-output` | Agent job | Safe-output jobs, detection job, conclusion job | AI agent execution output (JSON format) |
| `agent-artifacts` | Agent job | Detection job, conclusion job | Additional artifacts from agent execution |
| `agent_outputs` | Agent job | Safe-output jobs | Alternative name for agent outputs |
| `safe-output` | Safe-output jobs | Conclusion job | Safe output results (PR creation, commenting, etc.) |
| `safe-outputs-assets` | Safe-output jobs | Conclusion job | Assets generated by safe-output tools |
| `cache-memory` | Agent job, update_cache_memory job | Next workflow run | Persistent data across workflow runs |
| `cache-memory-focus-areas` | Agent job | Next workflow run | Focused cache data for specific areas |
| `cache-memory-repo-audits` | Agent job | Next workflow run | Repository audit cache data |
| `repo-memory-default` | Agent job | Next workflow run | Default repository memory data |
| `repo-memory-campaigns` | Agent job | Next workflow run | Campaign-specific repository memory |
| `python-source-and-data` | Agent job | Upload assets job | Python scripts and data files |
| `trending-source-and-data` | Agent job | Upload assets job | Trending analysis source and data |
| `trending-charts` | Agent job | Upload assets job | Charts generated from trending data |
| `data-charts` | Agent job | Upload assets job | General data visualization charts |
| `sbom-artifacts` | SBOM job | Download step | Software Bill of Materials artifacts |
| `super-linter-log` | Super-linter job | Debug step | Linter execution logs |
| `threat-detection.log` | Detection job | Conclusion job | Threat detection analysis logs |

## Common Job Names

Standard job names across compiled workflows:

| Job Name | Purpose | Runs After | Description |
|----------|---------|------------|-------------|
| `activation` | Workflow activation logic | N/A (first job) | Determines if workflow should run based on filters (membership, stop-time, skip-if-match, rate-limit, etc.) |
| `pre_activation` | Pre-activation checks | N/A (first job) | Runs before main activation logic for initial filtering |
| `agent` | AI agent execution | `activation` | Main AI agent execution job running copilot/claude/codex/custom engine |
| `detection` | Post-agent analysis | `agent` | Analyzes agent output for security threats, pattern matching, and anomalies |
| `safe_outputs` | Safe outputs execution | `agent`, `detection` | Processes safe-output tool calls from agent (PR creation, commenting, etc.) |
| `conclusion` | Final status reporting | All jobs | Runs after all other jobs complete, reports final status and cleanup |
| `config` | Configuration job | N/A (first job) | Sets up workflow configuration and environment |
| `test_environment` | Environment testing | `config` | Tests the workflow environment setup |
| `precompute` | Pre-computation | `activation` | Performs pre-computation before agent execution |
| `update_cache_memory` | Cache update | `agent` | Updates cache-memory artifacts with new data |
| `push_repo_memory` | Repository memory push | `agent` | Pushes repository memory data to storage |
| `unlock` | Workflow unlock | `agent` | Unlocks resources after agent execution |
| `upload_assets` | Asset upload | Safe-output jobs | Uploads generated assets to GitHub releases or storage |
| `post_to_slack_channel` | Slack notification | Safe-output jobs | Posts workflow results to Slack channel |
| `send_slack_message` | Slack message | Safe-output jobs | Sends individual Slack messages |
| `add_comment` | Comment addition | Safe-output jobs | Adds comments to issues/PRs |
| `create_pull_request` | PR creation | Safe-output jobs | Creates pull requests from agent changes |
| `notion_add_comment` | Notion comment | Safe-output jobs | Adds comments to Notion pages |
| `search_issues` | Issue search | Various | Searches GitHub issues based on criteria |
| `post-issue` | Issue posting | Various | Posts new GitHub issues |
| `release` | Release job | Build/test jobs | Creates GitHub releases |
| `super_linter` | Code linting | Various | Runs super-linter on codebase |
| `ast_grep` | AST analysis | Various | Runs AST-based code analysis |
| `check_ci_status` | CI status check | Various | Checks CI pipeline status |

## File Paths

Common file paths referenced in workflow files:

| Path | Type | Description | Usage Context |
|------|------|-------------|---------------|
| `.github/workflows/` | Directory | Workflow definition directory | Contains all `.md` and `.lock.yml` workflow files |
| `.github/aw/` | Directory | Agentic workflow configuration | Contains `actions-lock.json` and other configs |
| `.github/agents/` | Directory | Custom agent definitions | Contains agent markdown files (e.g., `test-agent.md`) |
| `/tmp/gh-aw/` | Directory | Temporary workflow data | Root temporary directory for all workflow artifacts |
| `/tmp/gh-aw/agent/` | Directory | Agent execution workspace | Agent's working directory during execution |
| `/tmp/gh-aw/agent-stdio.log` | File | Agent stdio logs | Standard input/output logs from agent |
| `/tmp/gh-aw/aw-prompts/prompt.txt` | File | Agent prompt file | Prompt text sent to AI agent |
| `/tmp/gh-aw/aw.patch` | File | Git patch file | Changes made by agent in patch format |
| `/tmp/gh-aw/aw_info.json` | File | Workflow info JSON | Workflow metadata and configuration |
| `/tmp/gh-aw/cache-memory` | Directory | Cache memory storage | Persistent cache data across runs |
| `/tmp/gh-aw/cache-memory-chroma` | Directory | Chroma cache storage | Chroma vector database cache |
| `/tmp/gh-aw/cache-memory-focus-areas` | Directory | Focus areas cache | Cached focus area data |
| `/tmp/gh-aw/cache-memory-repo-audits` | Directory | Repo audits cache | Cached repository audit data |
| `/tmp/gh-aw/layout-cache` | Directory | Layout cache | Cached layout specification data |
| `/tmp/gh-aw/prompt-cache` | Directory | Prompt cache | Cached prompt templates |
| `/tmp/gh-aw/repo-memory/default` | Directory | Default repo memory | Default repository memory storage |
| `/tmp/gh-aw/repo-memory/campaigns` | Directory | Campaigns repo memory | Campaign-specific repository memory |
| `/tmp/gh-aw/mcp-config/logs/` | Directory | MCP config logs | MCP configuration logs |
| `/tmp/gh-aw/mcp-logs/` | Directory | MCP server logs | Model Context Protocol server logs |
| `/tmp/gh-aw/redacted-urls.log` | File | Redacted URLs log | Log of URLs that were redacted for security |
| `/tmp/gh-aw/safeoutputs/` | Directory | Safe outputs data | Safe output tool results and metadata |
| `/tmp/gh-aw/safeoutputs/assets/` | Directory | Safe outputs assets | Assets generated by safe-output tools |
| `/tmp/gh-aw/safe-inputs/logs/` | Directory | Safe inputs logs | Safe input validation logs |
| `/tmp/gh-aw/sandbox/agent/logs/` | Directory | Sandbox agent logs | Agent logs from sandboxed execution |
| `/tmp/gh-aw/sandbox/firewall/logs/` | Directory | Sandbox firewall logs | Firewall logs from sandboxed execution |
| `/tmp/gh-aw/python/*.py` | Files | Python scripts | Python scripts generated or used by agent |
| `/tmp/gh-aw/python/charts/*.png` | Files | Python chart images | Chart images generated by Python scripts |
| `/tmp/gh-aw/python/data/*` | Files | Python data files | Data files used by Python scripts |
| `/opt/gh-aw/actions` | Directory | Setup action scripts | Destination for copied JavaScript and shell scripts |
| `/opt/gh-aw/safe-jobs/` | Directory | Safe job definitions | Safe output job definitions and handlers |
| `${{ env.GH_AW_AGENT_OUTPUT }}` | Environment var | Agent output path | Dynamic path to agent output file |
| `${{ env.GH_AW_SAFE_OUTPUTS }}` | Environment var | Safe outputs path | Dynamic path to safe outputs directory |

## Working Directories

Working directories used in workflow steps:

| Directory | Context | Description |
|-----------|---------|-------------|
| `./actions/setup/js` | Setup action development | JavaScript module development directory |
| `./docs` | Documentation | Documentation source directory |
| `actions/setup/js` | Setup action execution | JavaScript runtime directory during action execution |

## Go Constants (pkg/constants)

Key constants defined in Go code that relate to workflow layout:

### Artifact Names
````go
const SafeOutputArtifactName = "safe-output"
const AgentOutputArtifactName = "agent-output"
const AgentOutputFilename = "agent_output.json"
````

### Job Names
````go
const AgentJobName JobName = "agent"
const ActivationJobName JobName = "activation"
const PreActivationJobName JobName = "pre_activation"
const DetectionJobName JobName = "detection"
````

### Step IDs
````go
const CheckMembershipStepID StepID = "check_membership"
const CheckStopTimeStepID StepID = "check_stop_time"
const CheckSkipIfMatchStepID StepID = "check_skip_if_match"
const CheckSkipIfNoMatchStepID StepID = "check_skip_if_no_match"
const CheckCommandPositionStepID StepID = "check_command_position"
const CheckRateLimitStepID StepID = "check_rate_limit"
const CheckSkipRolesStepID StepID = "check_skip_roles"
const CheckSkipBotsStepID StepID = "check_skip_bots"
````

### Directory Paths
````go
const AWFProxyLogsDir = "/tmp/gh-aw/sandbox/firewall/logs"
const DefaultMCPGatewayPayloadDir = "/tmp/gh-aw/mcp-payloads"
````

### MCP Server IDs
````go
const SafeOutputsMCPServerID = "safeoutputs"
const SafeInputsMCPServerID = "safeinputs"
const AgenticWorkflowsMCPServerID = "agenticworkflows"
````

### Default Versions
````go
const DefaultCopilotVersion Version = "0.0.410"
const DefaultClaudeCodeVersion Version = "2.1.42"
const DefaultCodexVersion Version = "0.101.0"
const DefaultGitHubMCPServerVersion Version = "v0.30.3"
const DefaultFirewallVersion Version = "v0.18.0"
const DefaultMCPGatewayVersion Version = "v0.1.4"
const DefaultPlaywrightMCPVersion Version = "0.0.68"
const DefaultMCPSDKVersion Version = "1.24.0"
const DefaultBunVersion Version = "1.1"
const DefaultNodeVersion Version = "24"
const DefaultPythonVersion Version = "3.12"
const DefaultGoVersion Version = "1.25"
````

### Container Images
````go
const DefaultMCPGatewayContainer = "ghcr.io/github/gh-aw-mcpg"
const DefaultFirewallRegistry = "ghcr.io/github/gh-aw-firewall"
const DefaultSerenaMCPServerContainer = "ghcr.io/github/serena-mcp-server"
const OraiosSerenaContainer = "ghcr.io/oraios/serena"
const DefaultNodeAlpineLTSImage = "node:lts-alpine"
const DefaultPythonAlpineLTSImage = "python:alpine"
const DefaultAlpineImage = "alpine:latest"
const DevModeGhAwImage = "localhost/gh-aw:dev"
````

### Docker Mounts
````go
const DefaultGhAwMount = "/opt/gh-aw:/opt/gh-aw:ro"
const DefaultGhBinaryMount = "/usr/bin/gh:/usr/bin/gh:ro"
const DefaultTmpGhAwMount = "/tmp/gh-aw:/tmp/gh-aw:rw"
const DefaultWorkspaceMount = "${GITHUB_WORKSPACE}:${GITHUB_WORKSPACE}:rw"
````

### Network Ports
````go
const DefaultMCPGatewayPort = 80
const DefaultMCPServerPort = 3000
const DefaultMCPInspectorPort = 3001
const ClaudeLLMGatewayPort = 10000
const CodexLLMGatewayPort = 10001
const CopilotLLMGatewayPort = 10002
````

### URLs
````go
const DefaultMCPRegistryURL URL = "https://api.mcp.github.com/v0.1"
const GitHubCopilotMCPDomain = "api.githubcopilot.com"
````

### Timeouts
````go
const DefaultAgenticWorkflowTimeout = 20 * time.Minute
const DefaultToolTimeout = 60 * time.Second
const DefaultMCPStartupTimeout = 120 * time.Second
````

## Usage Guidelines

### Artifact Naming
- Use descriptive hyphenated names (e.g., `agent-output`, `mcp-logs`)
- Prefer consistency: `agent-output` over `agent_output`
- Use suffixes for categorization: `-logs`, `-assets`, `-data`

### Job Naming
- Use snake_case for job names (e.g., `create_pull_request`, `safe_outputs`)
- Standard job names: `activation`, `agent`, `detection`, `conclusion`
- Safe-output job names should match tool names (e.g., `add_comment`, `create_pull_request`)

### Path Conventions
- Use relative paths from repository root (e.g., `.github/workflows/`)
- Use `/tmp/gh-aw/` prefix for all temporary workflow data
- Use `/opt/gh-aw/` prefix for read-only action scripts and binaries
- Use environment variables for dynamic paths (e.g., `${{ env.GH_AW_AGENT_OUTPUT }}`)

### Action Pinning
- Always pin actions to full commit SHA for security (e.g., `actions/checkout@11bd719...`)
- Multiple SHAs indicate version evolution across different workflows
- Update SHAs when security patches are released

### Container Image Tagging
- Use version tags for stable releases (e.g., `v0.1.4`, `v0.18.0`)
- Use `:dev` tag for local development builds
- Use `latest` tag only for base images (e.g., `alpine:latest`)

## Patterns and Conventions

### Temporary File Structure
````
/tmp/gh-aw/
├── agent/                      # Agent workspace
├── agent-stdio.log             # Agent logs
├── aw-prompts/                 # Prompt storage
│   └── prompt.txt
├── aw.patch                    # Git patch
├── aw_info.json                # Workflow metadata
├── cache-memory/               # Persistent cache
├── cache-memory-chroma/        # Vector DB cache
├── cache-memory-focus-areas/   # Focus areas cache
├── cache-memory-repo-audits/   # Audit cache
├── mcp-config/logs/            # MCP config logs
├── mcp-logs/                   # MCP server logs
├── mcp-payloads/               # MCP gateway payloads
├── python/                     # Python scripts/data
│   ├── *.py
│   ├── charts/*.png
│   └── data/*
├── repo-memory/                # Repository memory
│   ├── campaigns/
│   └── default/
├── safe-inputs/logs/           # Safe input logs
├── safeoutputs/                # Safe output data
│   └── assets/
└── sandbox/                    # Sandbox execution
    ├── agent/logs/
    └── firewall/logs/
````

### GitHub Workflow Directory Structure
````
.github/
├── agents/                     # Custom agent definitions
│   └── test-agent.md
├── aw/                         # Workflow configuration
│   └── actions-lock.json
└── workflows/                  # Workflow files
    ├── *.md                    # Source workflows
    ├── *.lock.yml              # Compiled workflows
    └── shared/                 # Shared workflow components
````

### Safe Output Job Naming
Safe output jobs follow the pattern: `{tool_name}` where tool name is the MCP tool identifier:
- `add_comment` → adds comments to issues/PRs
- `create_pull_request` → creates pull requests
- `post_to_slack_channel` → posts to Slack
- `send_slack_message` → sends Slack messages
- `notion_add_comment` → adds Notion comments

### Activation Check Pattern
Activation jobs use multiple step IDs for filtering:
1. `check_membership` → Verify user is team member
2. `check_stop_time` → Check if workflow should stop based on time
3. `check_skip_if_match` → Skip if pattern matches
4. `check_skip_if_no_match` → Skip if pattern doesn't match
5. `check_command_position` → Verify command position in text
6. `check_rate_limit` → Enforce rate limiting
7. `check_skip_roles` → Skip based on user roles
8. `check_skip_bots` → Skip bot-triggered runs

## Document Maintenance

This specification is automatically maintained by the **Layout Specification Maintainer** workflow. When workflow patterns change:

1. The workflow scans all `.lock.yml` files
2. Extracts patterns using `yq` and grep
3. Reviews Go and JavaScript source code
4. Updates this document with findings
5. Creates a PR with the changes

**Last extraction run**: 2026-02-16
**Lock files analyzed**: 154
**Patterns documented**: 200+

---

*This document is automatically maintained by the Layout Specification Maintainer workflow.*
*For questions or corrections, please open an issue in the github/gh-aw repository.*
